



ğŸŒŸæœ¬åœ°æ–‡ä»¶åŠ©æ‰‹ï¼Œå¸®æˆ‘æŸ¥æ‰¾æ–‡ä»¶ã€‚

ğŸŒŸğŸŒŸæ“ä½œk8s é›†ç¾¤

ğŸŒŸğŸŒŸğŸŒŸæŸ¥12306ç«è½¦ç¥¨ä¿¡æ¯

ğŸŒŸğŸŒŸğŸŒŸğŸŒŸ é«˜å¾·åœ°å›¾ç”Ÿæˆæ—…æ¸¸æ”»ç•¥



##### çœ‹ä¼¼å¾ˆç®€å•çš„åŠŸèƒ½ï¼ŒçœŸæ­£å»å®ç°çš„æ—¶å€™å‘ç°å¾ˆå¤æ‚.

- å®ç° åŒ…å«åŠŸèƒ½é€»è¾‘ çš„å‡½æ•°, ä¾‹å¦‚æŸ¥è¯¢å¤©æ°”
- é€šçŸ¥llm å¯ä½¿ç”¨è¿™ä¸ªæ–¹æ³•
- æŒ‰ç…§æ¨¡å‹ è§„å®šçš„å‚æ•°ï¼Œä¼ é€’å‚æ•° 
- ç»´æŠ¤ç”¨æˆ·çš„ä¸Šä¸‹æ–‡

æˆ–è®¸ä½¿ç”¨ Langchain ç­‰å¼€å‘æ¡†æ¶èƒ½å¤Ÿçœç•¥éƒ¨åˆ†ä»£ç ï¼Œä½†æ¡†æ¶æœ¬èº«å°±æœ‰å¾ˆå¤šé—®é¢˜ï¼Œä¾‹å¦‚Langchain

[LangchainDemo](https://xiaoshenwei.github.io/use-langchain/)

- å­¦ä¹ æ›²çº¿è¾ƒé™¡, æ¨¡å—ä¼—å¤š
- æŠ½è±¡åº¦å¤ªé«˜ï¼Œä½¿ç”¨éš¾åº¦å¤§
-  ç¤¾åŒºæ›´æ–°å¿«, api å˜åŒ–å¿«

ğŸ¤• æœ€ä¸¥é‡çš„æ˜¯  Langchain å¼€å‘å‡ºæ¥çš„å°åŠ©æ‰‹ï¼Œ å¾ˆéš¾å»å…±äº«ç»™åˆ«äººä½¿ç”¨ã€‚ä¸€äº›ç»å…¸çš„åœºæ™¯ï¼Œ æ²¡æœ‰ç°æˆçš„è§£å†³æ–¹æ¡ˆã€‚

# ä»‹ç»

> Model Context Protocol (MCP)

2024å¹´11æœˆåº•ï¼Œç”± Anthropic æ¨å‡ºçš„ä¸€ç§å¼€æ”¾æ ‡å‡†ï¼Œæ—¨åœ¨ç»Ÿä¸€å¤§æ¨¡å‹ä¸å¤–éƒ¨æ•°æ®æºå’Œå·¥å…·ä¹‹é—´çš„é€šä¿¡åè®®

MCP æ˜¯ä¸€ç§å¼€æ”¾åè®®ï¼Œç”¨äºæ ‡å‡†åŒ–åº”ç”¨ç¨‹åºå‘å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰æä¾›ä¸Šä¸‹æ–‡çš„æ–¹å¼ã€‚å¯ä»¥æŠŠ MCP æƒ³è±¡æˆ AI åº”ç”¨ä¸­çš„ USB-C æ¥å£ã€‚æ­£å¦‚ USB-C ä¸ºå„ç§è®¾å¤‡ä¸å¤–è®¾ä¹‹é—´çš„è¿æ¥æä¾›äº†æ ‡å‡†åŒ–æ–¹å¼ï¼ŒMCP ä¹Ÿä¸º AI æ¨¡å‹ä¸ä¸åŒæ•°æ®æºå’Œå·¥å…·ä¹‹é—´çš„è¿æ¥æä¾›äº†æ ‡å‡†åŒ–æœºåˆ¶ã€‚

------

![](https://raw.githubusercontent.com/xiaoshenwei/xiaoshenwei.github.io/master/assets/images/0_HCnkXqCpEOkuwOuG.webp)

# ä¸ºä»€ä¹ˆéœ€è¦MCPï¼Ÿ

HTTPåè®®: åœ¨å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰ä¸æœåŠ¡å™¨ä¹‹é—´ä¼ è¾“æ•°æ®çš„ä¸€å¥—æ ‡å‡†è§„åˆ™å’Œæ ¼å¼

```
GET /index.html HTTP/1.1
Host: example.com

HTTP/1.1 200 OK
Content-Type: text/html

<html>...</html>
```

https://modelcontextprotocol.io/specification/2025-06-18/server/tools#protocol-messages

![](https://raw.githubusercontent.com/xiaoshenwei/xiaoshenwei.github.io/master/assets/images/482133859_9369860546463096_7290127014013680201_n.jpg)

ä¼ ç»Ÿçš„APIå¼€å‘æ–¹å¼ï¼Œ å¼€å‘è€…éœ€è¦ä¸ºå„ç§ä¸åŒçš„APIåšé›†æˆå¼€å‘

**æ—…è¡Œè§„åˆ’åŠ©æ‰‹**

- ä½¿ç”¨ APIï¼šéœ€è¦ä¸ºæ—¥å†ã€ç”µå­é‚®ä»¶ã€èˆªç©ºå…¬å¸é¢„è®¢ API ç¼–å†™å•ç‹¬çš„ä»£ç ï¼Œæ¯ä¸ª API éƒ½æœ‰è‡ªå®šä¹‰çš„èº«ä»½éªŒè¯ã€ä¸Šä¸‹æ–‡ä¼ é€’å’Œé”™è¯¯å¤„ç†é€»è¾‘ã€‚
- ä½¿ç”¨ MCPï¼šAI åŠ©æ‰‹å¯ä»¥é¡ºç•…åœ°æ£€æŸ¥æ—¥ç¨‹å®‰æ’ä»¥ç¡®è®¤ç©ºæ¡£æ—¶é—´ï¼Œé¢„è®¢æœºç¥¨ï¼Œå¹¶é€šè¿‡ç”µå­é‚®ä»¶å‘é€ç¡®è®¤ä¿¡æ¯ã€‚å…¨éƒ¨é€šè¿‡ MCP æœåŠ¡å™¨å®ç°ï¼Œæ— éœ€ä¸ºæ¯ä¸ªå·¥å…·è¿›è¡Œè‡ªå®šä¹‰é›†æˆã€‚



# ä¸ºä»€ä¹ˆé€‰æ‹© MCPï¼Ÿ

MCP å¸®åŠ©ä½ åœ¨å¤§è¯­è¨€æ¨¡å‹ä¹‹ä¸Šæ„å»ºæ™ºèƒ½ä»£ç†å’Œå¤æ‚çš„å·¥ä½œæµã€‚LLM ç»å¸¸éœ€è¦ä¸æ•°æ®å’Œå·¥å…·é›†æˆï¼Œè€Œ MCP æä¾›äº†ä»¥ä¸‹ä¼˜åŠ¿ï¼š

- è¶Šæ¥è¶Šå¤šçš„é¢„æ„å»ºé›†æˆï¼ŒLLM å¯ç›´æ¥æ¥å…¥ä½¿ç”¨
- åœ¨ä¸åŒ LLM æä¾›å•†å’Œå‚å•†ä¹‹é—´è‡ªç”±åˆ‡æ¢çš„çµæ´»æ€§
- åœ¨ä½ è‡ªèº«åŸºç¡€è®¾æ–½ä¸­ä¿æŠ¤æ•°æ®çš„æœ€ä½³å®è·µ

ğŸ¤æˆ‘å†™çš„å·¥å…·ä½ å¯ä»¥ç›´æ¥ç”¨ã€‚

ğŸ’°è‡ªç”±åˆ‡æ¢å‚å•†

ãŠ™ï¸æ•°æ®ç›¸å¯¹å¯æ§



# MCPå’ŒFunction Callçš„åŒºåˆ«ç©¶ç«Ÿåœ¨å“ªé‡Œ?

## Function Callï¼ˆå‡½æ•°è°ƒç”¨)

### ä¸€ã€ä»€ä¹ˆæ˜¯ Function Callï¼Ÿ

åœ¨å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰ä¸­ï¼ŒFunction Call æŒ‡çš„æ˜¯ï¼š
> **æ¨¡å‹æ ¹æ®ç”¨æˆ·è¾“å…¥ï¼Œä¸»åŠ¨è°ƒç”¨å¤–éƒ¨å®šä¹‰çš„å‡½æ•°ï¼ˆAPIï¼‰æ¥å®Œæˆä»»åŠ¡**ã€‚

é€šè¿‡ Function Callï¼Œæ¨¡å‹å¯ä»¥è¿æ¥æ•°æ®åº“ã€æ’ä»¶ã€å·¥å…·ç­‰ï¼Œçªç ´å…¶åŸå§‹çŸ¥è¯†è¾¹ç•Œã€‚

---

### äºŒã€Function Call å·¥ä½œæµç¨‹

ä»¥ä¸‹æ˜¯æ ‡å‡†çš„ Function Call æ‰§è¡Œæµç¨‹

1. **ç”¨æˆ·æé—®**ï¼Œ

è¯·æŸ¥è¯¢åŒ—äº¬æ˜å¤©çš„å¤©æ°”

2. **æ¨¡å‹åˆ¤æ–­æ˜¯å¦è°ƒç”¨å‡½æ•°**

- æ¨¡å‹åˆ†æé—®é¢˜è¶…å‡ºè®­ç»ƒçŸ¥è¯†
- åˆ¤æ–­éœ€è¦å®æ—¶è°ƒç”¨å¤–éƒ¨å‡½æ•°

3. **ç”Ÿæˆå‡½æ•°è°ƒç”¨è¯·æ±‚ï¼ˆJSONï¼‰**

```json
{
  "name": "getWeather",
  "arguments": {
    "location": "åŒ—äº¬",
    "date": "2025-06-26"
  }
}
```

4. **å¹³å°æ‰§è¡Œå‡½æ•°**

ç³»ç»Ÿæ¥æ”¶åˆ°è¯·æ±‚åï¼Œè°ƒç”¨å¼€å‘è€…å®ç°çš„å®é™…å‡½æ•°ï¼ˆå¦‚åç«¯ APIï¼‰

5. **å‡½æ•°è¿”å›ç»“æœ**

```json
{
  "temperature": "32Â°C",
  "condition": "æ™´"
}
```

6. **æ¨¡å‹åŸºäºç»“æœç”Ÿæˆå›å¤**

æ˜å¤©åŒ—äº¬çš„å¤©æ°”æ˜¯æ™´ï¼Œæœ€é«˜æ°”æ¸© 32Â°Cã€‚

![](https://raw.githubusercontent.com/xiaoshenwei/xiaoshenwei.github.io/master/assets/images/func-call.png)







## MCPæ¶æ„

MCP çš„æ ¸å¿ƒæ˜¯å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¶æ„ï¼Œå…¶ä¸­ä¸»æœºåº”ç”¨ç¨‹åºå¯ä»¥è¿æ¥åˆ°å¤šä¸ªæœåŠ¡å™¨

```mermaid
flowchart LR
    subgraph "Your Computer"
        Host["Host with MCP Client\n(Claude, IDEs, Tools)"]
        S1["MCP Server A"]
        S2["MCP Server B"]
        S3["MCP Server C"]
        Host <-->|"MCP Protocol"| S1
        Host <-->|"MCP Protocol"| S2
        Host <-->|"MCP Protocol"| S3
        S1 <--> D1[("Local\nData Source A")]
        S2 <--> D2[("Local\nData Source B")]
    end
    subgraph "Internet"
        S3 <-->|"Web APIs"| D3[("Remote\nService C")]
    end
```

æ€»å…±åˆ†ä¸ºäº†ä¸‹é¢äº”ä¸ªéƒ¨åˆ†ï¼š

- MCP Hosts: Hosts æ˜¯æŒ‡ LLM å¯åŠ¨è¿æ¥çš„åº”ç”¨ç¨‹åºï¼Œåƒ Cursor, Claude Desktopã€[Cline](https://github.com/cline/cline) è¿™æ ·çš„åº”ç”¨ç¨‹åºã€‚
- MCP Clients: å®¢æˆ·ç«¯æ˜¯ç”¨æ¥åœ¨ Hosts åº”ç”¨ç¨‹åºå†…ç»´æŠ¤ä¸ Server ä¹‹é—´ 1:1 è¿æ¥ã€‚
- MCP Servers: é€šè¿‡æ ‡å‡†åŒ–çš„åè®®ï¼Œä¸º Client ç«¯æä¾›ä¸Šä¸‹æ–‡ã€å·¥å…·å’Œæç¤ºã€‚
- Local Data Sources: æœ¬åœ°çš„æ–‡ä»¶ã€æ•°æ®åº“å’Œ APIã€‚
- Remote Services: å¤–éƒ¨çš„æ–‡ä»¶ã€æ•°æ®åº“å’Œ APIã€‚

![](https://raw.githubusercontent.com/xiaoshenwei/xiaoshenwei.github.io/master/assets/images/mcp.png)



# è®¨è®º:

å¦‚ä½•ç†è§£ MCP Host ä¸ MCP Client çš„ä¸åŒï¼Ÿ 

å¦‚ä½•ç†è§£ Client 1:1 Server ?



# æ„å»ºç¬¬ä¸€ä¸ªserver

MCP æ ¸å¿ƒæ¦‚å¿µï¼ˆCore MCP Conceptsï¼‰

MCP æœåŠ¡å™¨å¯ä»¥æä¾›ä¸‰ç§ä¸»è¦ç±»å‹çš„èƒ½åŠ›ï¼š

1. **èµ„æºï¼ˆResourcesï¼‰**
    ç±»ä¼¼æ–‡ä»¶çš„æ•°æ®ï¼Œå¯ä»¥è¢«å®¢æˆ·ç«¯è¯»å–ï¼ˆä¾‹å¦‚ API å“åº”æˆ–æ–‡ä»¶å†…å®¹ï¼‰
2. **å·¥å…·ï¼ˆToolsï¼‰**ï¼š
    å¯ä»¥è¢«å¤§è¯­è¨€æ¨¡å‹è°ƒç”¨çš„å‡½æ•°ï¼ˆéœ€è¦ç”¨æˆ·æ‰¹å‡†ï¼‰
3. **æç¤ºï¼ˆPromptsï¼‰**ï¼š
    é¢„å…ˆç¼–å†™çš„æ¨¡æ¿ï¼Œå¸®åŠ©ç”¨æˆ·å®Œæˆç‰¹å®šä»»åŠ¡

```python
import os
import pymysql
from dotenv import load_dotenv
from mcp.server.fastmcp import FastMCP

# Initialize FastMCP server
mcp = FastMCP("mysql-mcp")

load_dotenv()

MYSQL_CONFIG = {
    "host": os.getenv("MYSQL_HOST"),
    "user": os.getenv("MYSQL_USER"),
    "password": os.getenv("MYSQL_PASSWORD"),
    "database": os.getenv("MYSQL_DATABASE"),
    "port": int(os.getenv("MYSQL_PORT", 3306)),
}

def get_db_connection():
    """è·å– pymysql æ•°æ®åº“è¿æ¥"""
    try:
        conn = pymysql.connect(**MYSQL_CONFIG)
        return conn
    except pymysql.MySQLError as err:
        print(f"æ•°æ®åº“è¿æ¥å¤±è´¥: {err}")
        raise


@mcp.resource("test://{name}")
def hello(name) -> str:
    """ç®€å•çš„æµ‹è¯•èµ„æº"""
    return f"Hello, {name}!"

@mcp.tool(name="list_tables")
async def list_tables() -> list:
    """è·å–æ‰€æœ‰çš„è¡¨ååˆ—è¡¨"""
    conn = get_db_connection()
    try:
        with conn.cursor() as cursor:
            cursor.execute("SHOW TABLES;")
            result = cursor.fetchall()
            return [row[0] for row in result]
    except Exception as e:
        print(f"æŸ¥è¯¢è¡¨å¤±è´¥: {e}")
        return []
    finally:
        conn.close()


@mcp.tool(name="get_table_data")
async def get_table_data(table_name: str, limit: int = 100) -> list:
    """è·å–æŒ‡å®šè¡¨çš„æ•°æ®"""
    conn = get_db_connection()
    try:
        with conn.cursor() as cursor:
            cursor.execute(f"SELECT * FROM `{table_name}` LIMIT %s", (limit,))
            rows = cursor.fetchall()
            return rows
    finally:
        conn.close()


@mcp.resource("db://tables/{table_name}/data/{limit}")
async def get_table_data(table_name: str, limit: int = 100) -> list:
    """è·å–æŒ‡å®šè¡¨çš„æ•°æ®"""
    conn = get_db_connection()
    try:
        with conn.cursor() as cursor:
            cursor.execute(f"SELECT * FROM `{table_name}` LIMIT %s", (limit,))
            rows = cursor.fetchall()
            return rows
    finally:
        conn.close()

@mcp.tool()
async def add(a: float, b : float) -> float:
    """åŠ æ³•è¿ç®—

    å‚æ•°:
    a: ç¬¬ä¸€ä¸ªæ•°å­—
    b: ç¬¬äºŒä¸ªæ•°å­—

    è¿”å›:
    ä¸¤æ•°ä¹‹å’Œ
    """
    return a + b + 1

if __name__ == "__main__":
    # Initialize and run the server
    mcp.run(transport='stdio')

```

å¯åŠ¨ mcp Inspector è°ƒè¯•server
```
mcp dev main.py
```

